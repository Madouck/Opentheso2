<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"  
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:p="http://primefaces.org/ui"
             xmlns:f="http://xmlns.jcp.org/jsf/core">
    <style>
        body .ui-button.rounded-button.ui-button-icon-only {
            height: 1.5rem;
            width: 1.5rem;
        }
        body .ui-button.ui-button-icon-only .ui-icon {
            margin-top: -0.43rem;
            margin-left: -0.4rem;
            font-size: 0.7rem;
        }        
    </style>

    <div class="row">
        <div class="col-12">
            <h:outputText style="font-weight: bold;margin-top: 10px;" value="#{langueBean.getMsg('candidat.file')} "/>
            <h:outputText style="font-size: 14px; color: #f47b2a;" value=" (#{candidatBean.candidatSelected.createdBy})" 
                          title="#{langueBean.getMsg('rightbody.concept.createdBy')} #{candidatBean.candidatSelected.createdBy}"/>
        </div>
    </div>

    <!-- prefLabel -->
    <div class="row" style="margin-top: 10px">
        <div class="col-12">
            <h:outputText value="#{langueBean.getMsg('candidat.title')}"/>
        </div>
    </div>
    <div class="row" id="vote">
        <div class="col-8">
            <p:inputText id="inputTextCandidate" readonly="#{!candidatBean.isMyCandidate()}"
                         value="#{candidatBean.candidatSelected.nomPref}" style="width: 100%; height: 35px" >
            </p:inputText>
            <p:tooltip for="inputTextCandidate" value="Ne peut être modifié que par le créateur" showDelay="1000" position="top"/>
        </div>
        <h:panelGroup id="votePanel" rendered="#{!candidatBean.isNewCandidatActivate()}">
            <div class="col-1" style="margin-top: 8px">
                <p:commandButton rendered="#{candidatBean.candidatSelected.voted}"
                                 actionListener="#{candidatBean.addVote()}"  update="votePanel"
                                 styleClass="rounded-button col-lg-5"
                                 icon="fas fa-thumbs-up" style="background-color: #f47b2a; border-color: #C8EAD6;"/>

                <p:commandButton rendered="#{!candidatBean.candidatSelected.voted}"
                                 actionListener="#{candidatBean.addVote()}" update="votePanel"
                                 styleClass="rounded-button"
                                 icon="fas fa-thumbs-up" style="background-color: #EEF4FF; color: #000"/>
            </div>
        </h:panelGroup>
    </div>

    <!-- collection -->
    <div class="row" style="margin-top: 7px">
        <div class="col-12">
            <h:outputText value="#{langueBean.getMsg('candidat.domaine')}"/>
        </div>
    </div>
    <div class="row">
        <div class="col-8" >
            <p:autoComplete value="#{candidatBean.candidatSelected.collections}" multiple="true"
                            var="values" forceSelection="true" completeMethod="#{candidatBean.searchCollection}"                                  
                            minQueryLength="1" itemLabel="#{values.value}" itemValue="#{values}" converter="searchConverterIdValue"
                            scrollHeight="300" style="width: 100%;">
                <p:column style="font-size: 12px;">
                    <h:outputText title="#{values.id}" value="#{values.value}"/>
                </p:column>                
            </p:autoComplete> 
        </div>
    </div>

    <!-- pour les relations BT -->    
    <div class="row" style="margin-top: 7px">
        <div class="col-12">
            <h:outputText value="#{langueBean.getMsg('candidat.generic_term')}" />
        </div>
    </div>    
    <div class="row">    
        <div class="col-8">
            <p:autoComplete id="autoBroaderLink" value="#{candidatBean.candidatSelected.termesGenerique}"
                            multiple="true" var="values" forceSelection="true" style="width: 100%;"
                            completeMethod="#{candidatBean.searchTerme2}" minQueryLength="1" scrollHeight="300"
                            itemLabel="#{values.value}" itemValue="#{values}" converter="searchConverterIdValue">
                <p:column style="font-size: 12px;">
                    <h:outputText title="#{values.id}" value="#{values.value}"/>
                </p:column>
            </p:autoComplete>   
        </div>
    </div>

    <!-- pour les relations RT -->       
    <div class="row" style="margin-top: 10px;">
        <div class="col-12">
            <h:outputText value="#{langueBean.getMsg('candidat.associeted_terms')}" />
        </div>
    </div>
    <div class="row">
        <div class="col-8">
            <p:autoComplete id="autoRelatedLink" value="#{candidatBean.candidatSelected.termesAssocies}"
                            multiple="true" var="values" forceSelection="true" style="width: 100%"
                            completeMethod="#{candidatBean.searchTerme2}" minQueryLength="1" scrollHeight="300" 
                            itemLabel="#{values.value}" itemValue="#{values}" converter="searchConverterIdValue" >
                <p:column  style="font-size: 12px;">
                    <h:outputText title="#{values.id}" value="#{values.value}" />
                </p:column>
            </p:autoComplete>               
        </div>
    </div>

    <!-- pour les synonymes -->     
    <div class="row" style="margin-top: 10px;">
        <div class="col-12">
            <h:outputText value="#{langueBean.getMsg('candidat.used_for')}" style="margin-top: 15px;"/>
        </div>
    </div>
    <div class="row">    
        <div class="col-10">
            <p:inputText value="#{candidatBean.candidatSelected.employePour}"
                         placeholder="Entrer ou virgule pour un autre label"  style="width: 100%"/>
        </div>
    </div>

    <!-- Validation et enregistrement des nouvelles données ci-dessus -->
    <div class="row" style="margin-top: 10px">
        <div class="col-12" style="text-align: right" >
            <p:commandButton title="#{langueBean.getMsg('candidat.save')}" ajax="true"
                             class="btn btn-primary" actionListener="#{candidatBean.saveConcept()}"
                             update="messageIndex" />
        </div>
    </div>

    <!-- pour les 2 sections ci-dessous, l'enregistrement des données est automatique -->
    <h:panelGroup id="candidateInfos" rendered="#{!candidatBean.isNewCandidatActivate()}" style="margin: 10px;" >
        
        
        <!-- gestion des notes -->
        <div class="row">
            <div class="col-12">
                <p:commandLink value="#{langueBean.getMsg('rightbody.concept.add_note')}" actionListener="#{noteBeanCandidat.reset()}" 
                               oncomplete="PF('newNote').show();" update="idNewNote" ajax="true" process="@this">
                    <a class="fas fa-plus-circle" style="color: #f47b2a"  />
                </p:commandLink>
            </div>
        </div>

        <h:panelGroup rendered="#{candidatBean.candidatSelected.nodeNotes == null ||
                                  candidatBean.candidatSelected.nodeNotes.size() == 0}">
            <div class="row">
                <div class="col-12">
                    <h:outputText value="Aucune note pour le moment ..." style="color: grey; font-style: italic"/>
                </div>
            </div>
        </h:panelGroup>

        <h:panelGroup rendered="#{candidatBean.candidatSelected.nodeNotes.size() > 0}" >
            <ui:repeat id="listNotes" var="note" value="#{candidatBean.candidatSelected.nodeNotes}" >
                <div class="row" style="padding-top: 5px; background-color: #{viewEditionBean.getAlternateColor(candidatBean.candidatSelected.nodeNotes.indexOf(note))}"
                     tooltip="Ajouté par #{candidatBean.getUserName(note.idUser)}" tooltip-delay-show="500">
                    <div class="col-4" >
                        <h:outputText value="#{note.lexicalvalue}" escape="false" style="font-size: 14px;"/>
                    </div>
                    <div class="col-2" >
                        <h:outputText value="#{candidatBean.getUserName(note.idUser)}" escape="false" style="font-size: 14px;"/>
                    </div>                    
                    <div class="col-2" >
                        <h:outputText value="#{note.notetypecode}" escape="false" style="font-size: 14px;"/>
                    </div>
                    <div class="col-1" >
                        <h:outputText value="#{note.lang}" style="font-size: 14px;"/>
                    </div>
                    <div class="col-1" style="margin-top: -2px;">                        
                        <p:commandButton rendered="#{candidatBean.candidatSelected.userId == note.idUser}" class="ui-button-success rounded-button" icon="fas fa-pen" process="@this"
                                         actionListener="#{noteBeanCandidat.resetEditNode(note)}" update="editNoteForm"
                                         oncomplete="PF('editNote').show();"/>
                        
                    </div>
                    <div class="col-1" style="margin-top: -2px;">
                        <p:commandButton rendered="#{candidatBean.candidatSelected.userId == note.idUser}" icon="pi pi-trash" styleClass="rounded-button ui-button-danger" process="@this" ajax="true"
                                         actionListener="#{noteBeanCandidat.setSelectedNodeNote(note)}" update="idDeleteNote"
                                         oncomplete="PF('deleteNote').show();" />
                    </div>
                    <div class="col-1" style="margin-top: -2px;">
                        <p:commandButton rendered="#{note.voted}" actionListener="#{candidatBean.addNoteVote(note)}"
                                         update="tabViewCandidat messageIndex" ajax="true" process="@this" styleClass="rounded-button"
                                         icon="fas fa-thumbs-up" style="background-color: #f47b2a;"/>

                        <p:commandButton rendered="#{!note.voted}" update="tabViewCandidat messageIndex"
                                         icon="fa fa-thumbs-up fa-xs" styleClass="rounded-button ui-button-secondary"
                                         actionListener="#{candidatBean.addNoteVote(note)}" ajax="true" process="@this"
                                         style="background-color: #EEF4FF; color: #000"/>
                    </div>
                </div>
            </ui:repeat>
        </h:panelGroup>

        <!-- gestion des traductions -->
        <div class="row" style="margin-top: 20px">
            <div class="col-12">
                <p:commandLink value="#{langueBean.getMsg('rightbody.concept.add_traduction')}" update="idNewTraduction newTraductionForm"
                               oncomplete="PF('newTraduction').show();" actionListener="#{traductionService.init()}">
                    <a class="fas fa-plus-circle" style="color: #f47b2a" />
                </p:commandLink>
            </div>
        </div>

        <h:panelGroup rendered="#{candidatBean.candidatSelected.traductions.size() == 0}" style="margin-top: 10px">
            <div class="row">
                <div class="col-12">
                    <h:outputText  value="Aucune traduction pour le moment ..." style="color: grey; font-style: italic " />
                </div>
            </div>
        </h:panelGroup>

        <h:panelGroup rendered="#{candidatBean.candidatSelected.traductions.size() > 0}" style="margin-top: 10px">
            <div class="row" style="font-size: 12px; color: #666666">
                <div class="col-4" style="margin-top: -2px;">
                    <h:outputText value="#{langueBean.getMsg('candidat.language')}"/>
                </div>
                <div class="col-4">
                    <h:outputText value="#{langueBean.getMsg('candidat.traduction')}"/>
                </div>
                <div class="col-2">
                    <h:outputText value="#{langueBean.getMsg('candidat.edit')}"/>
                </div>
                <div class="col-2">
                    <h:outputText value="#{langueBean.getMsg('candidat.remove')}"/>
                </div>
            </div>

            <ui:repeat id="listTraduction" var="traduction" value="#{candidatBean.candidatSelected.traductions}">
                <div class="row" style="background-color: #{viewEditionBean.getAlternateColor(candidatBean.candidatSelected.traductions.indexOf(traduction))};
                     padding-top: 5px" >
                    <div class="col-4" style="margin-top: -2px;">
                        <h:outputText value="#{traduction.langue}" style="font-size: 14px;"/>
                    </div>
                    <div class="col-4" style="margin-top: -2px;">
                        <h:outputText value="#{traduction.traduction}" style="font-size: 14px;"/>
                    </div>
                    <div class="col-2" style="margin-top: -2px;">
                        <p:commandButton class="ui-button-success rounded-button" icon="fas fa-pen"
                                         update=":manage-traduction-content"
                                         oncomplete="PF('editTraduction').show();" 
                                         actionListener="#{traductionService.init(traduction)}" process="@this"
                                         styleClass="edit-button rounded-button ui-button-success">
                            <p:resetInput target=":manage-traduction-content"/>
                        </p:commandButton>
                    </div>

                    <div class="col-2">
                        <p:commandButton icon="pi pi-trash" styleClass="rounded-button ui-button-danger"
                                         actionListener="#{traductionService.init(traduction)}" update="confirmDeleteForm"
                                         oncomplete="PF('confirmDeleteTraduction').show();" />
                    </div>
                </div>
            </ui:repeat>
        </h:panelGroup>
    </h:panelGroup>
</ui:fragment>