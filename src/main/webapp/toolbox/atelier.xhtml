<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Opentheso</title>

        <link href="../resources/img/icon_opentheso2.png" rel="icon" />

        <link rel="stylesheet" type="text/css" href="../resources/css/all.css" />
        <link rel="stylesheet" type="text/css" href="../resources/css/theme_general.css" />
        <link rel="stylesheet" type="text/css" href="../resources/css/theme_opentheso.css" />
        <link rel="stylesheet" type="text/css" href="../resources/css/composants_opentheso.css" />

        <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces"/>
    </h:head>


    <h:body id="page-top" onload="closeMenu()">

        <p:idleMonitor timeout="#{connect.timeout}">
            <p:ajax event="idle" listener="#{sessionControl.isTimeout}" />
        </p:idleMonitor>

        <f:metadata>
            <f:viewParam name="idc" value="#{selectedTheso.idConceptFromUri}"/>
            <f:viewParam name="idt" value="#{selectedTheso.idThesoFromUri}"/>
            <f:viewAction action="#{selectedTheso.preRenderView}"/>
        </f:metadata>

        <p:growl id="messageIndex" globalOnly="true" showDetail="true"/>

        <h:panelGroup rendered="#{menuBean.checkIfUserIsConnected()}" id="wrapper" style="height: 100%" >

            <ui:include src="../commun/menu.xhtml" />

            <div id="content-wrapper" style="width: 100%">

                <h:form id="containerIndex">
                    <div>
                        <ui:include src="../commun/header.xhtml" />
                    </div>

                    <div class="container-fluid">

                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <h1 class="h3 mb-0 text-gray-800">Boite à outils / <span style="color: #f47b2a">Atelier thésaurus</span></h1>
                        </div>

                        <div class="col-12" style="height: 100%">
                            <div class="card shadow mb-4" style="height: 100%; padding: 20px; color: #000">

                                <p:wizard widgetVar="wiz" nextLabel="Suivant" backLabel="Précédent" flowListener="#{atelierThesBean.onFlowProcess}" >

                                    <p:tab id="actions" title="Choix de l'action" titleStyleClass="tabCostum">

                                        <p:panel styleClass="redColoredPanel" style="padding: 10px">
                                            <p:outputLabel value="Veuillez choisir l'action que vous voulez faire : " style="color: #000"/>
                                            <p:selectOneRadio value="#{atelierThesBean.actionSelected}" unselectable="true" layout="pageDirection">
                                                <f:selectItem itemLabel="Comparaison d'un fichier aux thésaurus" itemValue="opt1"/>
                                                <f:selectItem itemLabel="Correction globale" itemValue="opt2"/>
                                                <f:selectItem itemLabel="Fusionner deux thésaurus" itemValue="opt3"/>
                                            </p:selectOneRadio>
                                        </p:panel>
                                    </p:tab>

                                    <p:tab id="entre" title="Entrées" titleStyleClass="tabCostum">

                                        <p:panel id="fussion" rendered="#{atelierThesBean.isRubriqueSelected('opt3')}" style="padding: 10px">

                                            <h6 style="color: #43B572; font-weight: bold; margin-top: 10px">Importation du thésorus source</h6>

                                            <p:fileUpload listener="#{fusionService.importTheso}" update="fussion" label="parcourir" 
                                                          mode="advanced" auto="true" allowTypes="/(\.|\/)(skos|rdf|xml|json|ttl)$/" />

                                            <h:panelGroup rendered="#{fusionService.loadDone}">
                                                <div class="row" style="margin-left: 30px; margin-right: 30px; font-size: 12px;">
                                                    <div class="col-12">
                                                        <h:outputText value="URI: " />
                                                        <h:outputText value="#{fusionService.uri}" style="color: #C63632"/>
                                                    </div>
                                                </div>
                                                <div class="row" rendered="#{fusionService.loadDone}" style="margin-left: 30px; margin-right: 30px; font-size: 12px;">
                                                    <div class="col-12">
                                                        <h:outputText value="Total des concepts: " />
                                                        <h:outputText value="#{fusionService.total}" style="color: #C63632"/>
                                                    </div>
                                                </div>
                                            </h:panelGroup>
                                        </p:panel>

                                        <p:panel style="padding: 10px">
                                            <h6 style="color: #43B572; font-weight: bold; margin-top: 10px">Les données de comparaison</h6>
                                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
                                                <p:outputLabel for="@next" value="Délimiteur Csv :" style="color: #000" />
                                                <p:selectOneMenu value="#{atelierThesBean.choiceDelimiter}" >
                                                    <f:selectItem itemLabel="," itemValue="0" />
                                                    <f:selectItem itemLabel=";" itemValue="1" />
                                                    <f:selectItem itemLabel="\t" itemValue="2" />
                                                    <p:ajax event="change" listener="#{atelierThesBean.actionChoice()}" />
                                                </p:selectOneMenu>
                                            </h:panelGrid>

                                            <div class="row">
                                                <div class="col-12" >
                                                    <p:fileUpload listener="#{atelierThesBean.loadFileCsv}" label="parcourir" mode="advanced" auto="true"
                                                                  update="containerIndex" allowTypes="/(\.|\/)(csv|txt)$/" />
                                                </div>
                                            </div>

                                            <p:panel style="margin-top: 10px">
                                                <h6 style="color: #43B572; font-weight: bold; margin-top: 10px">Les données chargées</h6>
                                                <h:outputText value="Nombre des données récupérées : #{atelierThesBean.values.size()}" style="color: #000" />

                                                <h:form style="margin-top: 15px">

                                                    <p:scrollPanel mode="native" style="width: 100%; max-height: 200px; border-width: 0">

                                                        <h:panelGroup rendered="#{atelierThesBean.values.size() == 0}" >
                                                            <div class="row">
                                                                <div class="col-12">
                                                                    <h:outputText  value="Aucune donnée pour le moment ..." style="color: grey; font-style: italic" />
                                                                </div>
                                                            </div>
                                                        </h:panelGroup>

                                                        <div class="row">
                                                            <ui:repeat var="title" value="#{atelierThesBean.titles}">
                                                                <div span="#{atelierThesBean.spanTable}">
                                                                    <h:outputText value="#{title}"/>
                                                                </div>
                                                            </ui:repeat>
                                                        </div>

                                                        <p:separator styleClass="separator" style="margin-top: 2px; margin-bottom: 2px" 
                                                                     rendered="#{atelierThesBean.values.size() > 0}"/>

                                                        <ui:repeat var="ligne" value="#{atelierThesBean.values}">
                                                            <div class="row">
                                                                <ui:repeat var="value" value="#{ligne}">
                                                                    <div span="#{atelierThesBean.spanTable}">
                                                                        <h:outputText value="#{value}"/>
                                                                    </div>
                                                                </ui:repeat>
                                                            </div>
                                                        </ui:repeat>

                                                        <p:separator styleClass="separator" style="margin-top: 2px; margin-bottom: 2px"/>

                                                    </p:scrollPanel>

                                                </h:form>

                                                <h:panelGrid columns="2" style="margin-top: 15px" cellpadding="5" rendered="#{atelierThesBean.titles.size() > 0}">
                                                    <p:outputLabel for="@next" value="Colone à comparer :" style="margin-right: 10px; color: #000" />
                                                    <p:selectOneMenu value="#{atelierThesBean.selectedColumn}" style="font-size: 12px; background: white; border-color: #43B572">
                                                        <f:selectItems value="#{atelierThesBean.titles}" var="titre"
                                                                       itemLabel="#{titre}" itemValue="#{titre}"/>
                                                    </p:selectOneMenu> 
                                                </h:panelGrid>

                                            </p:panel>

                                        </p:panel>

                                    </p:tab>

                                    <p:tab id="thesaurus" title="Les thésaurus" titleStyleClass="tabCostum">
                                        <p:panel>
                                            <h6 style="color: #43B572; font-weight: bold; margin-top: 10px">Liste des thésaurus</h6>
                                            <h:outputText value="Veuillez selectionez un thésaurus : " />
                                            <p:dataTable var="thes" value="#{atelierThesBean.nodeListTheso}" 
                                                         selection="#{atelierThesBean.thesoSelected}" rowKey="#{thes.id}" style="margin-top: 10px">
                                                <p:column selectionMode="single" style="width: 35px; text-align: center" />
                                                <p:column headerText="Id">
                                                    <h:outputText value="#{thes.id}" />
                                                </p:column>
                                                <p:column headerText="Valeur">
                                                    <h:outputText value="#{thes.value}" />
                                                </p:column>
                                                <p:column headerText="Statut">
                                                    <h:outputText value="#{thes.status}" />
                                                </p:column>
                                            </p:dataTable>
                                        </p:panel>
                                    </p:tab>

                                    <p:tab id="resultat" title="Résultat" titleStyleClass="tabCostum">
                                        <p:panel rendered="#{atelierThesBean.isRubriqueSelected('opt3')}">                                           
                                            <div class="row">
                                                <div class="col-12">
                                                    <h:outputText value="Vous êtes sur le point de fussioner un thésaurus importé dans la thésaurus ' #{atelierThesBean.thesoSelected.value}' ! "
                                                                  style="color: #000"/>
                                                </div>
                                            </div>

                                            <div class="row" style="margin-top: 10px">
                                                <div class="col-12">
                                                    <p:commandButton id="fussionBtn" value="Lancer la fussion" icon="fas fa-search" disabled="#{fusionService.fusionBtnEnable}"
                                                                     style="color: white; background: #43B572; border: #43B572; margin-top: 10px" process="@this" 
                                                                     actionListener="#{atelierThesBean.fusionner()}" update="containerIndex"/>
                                                </div>
                                            </div>

                                            <h:panelGroup id="statistiques" rendered="#{fusionService.fusionDone}">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <h6>Conceptes ajoutés : #{fusionService.conceptsAjoutes.size()}</h6>
                                                        <p:orderList value="#{fusionService.conceptsAjoutes}" var="concepte1" controlsLocation="none"
                                                                     itemLabel="#{concepte1}" itemValue="#{concepte1}" />
                                                    </div>
                                                    <div class="col-6">
                                                        <h6>Conceptes modifiés : #{fusionService.conceptsModifies.size()}</h6>
                                                        <p:orderList value="#{fusionService.conceptsModifies}" var="concepte2" controlsLocation="none"
                                                                     itemLabel="#{concepte2}" itemValue="#{concepte2}" />
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    Le nombre de conceptes déjà existent : #{fusionService.conceptsExists.size()}
                                                </div>
                                                <br/>
                                            </h:panelGroup>
                                        </p:panel>

                                        <p:panel rendered="#{atelierThesBean.isRubriqueSelected('opt1')}">
                                            <div class="row">
                                                <div class="col-12">
                                                    <h:outputText value="Vous êtes sur le point de comparer chaque valeur de la colone '#{atelierThesBean.selectedColumn}
                                                                  ' à l'ensemble des termes du thésaurus '#{atelierThesBean.thesoSelected.value}' ! "
                                                                  style="color: #000"/>
                                                </div>
                                            </div>

                                            <div class="row" style="margin-top: 10px">
                                                <div class="col-12">
                                                    <p:commandButton value="Lancer la comparaison" icon="fas fa-search" process="@this" 
                                                                     style="color: white; background: #43B572; border: #43B572; margin-top: 10px"
                                                                     actionListener="#{atelierThesBean.comparer()}" update="containerIndex" />
                                                </div>
                                            </div>

                                            <p:scrollPanel mode="native" style="margin-top: 10px; width: 100%; max-height: 450px;"
                                                           rendered="#{atelierThesBean.result.size() > 0}">
                                                <p:dataTable id="tbl" var="resultat" value="#{atelierThesBean.result}">
                                                    <p:column headerText="Id Origine" style="background-color: #ebedf0;">
                                                        <h:outputText value="#{resultat.idOrigine}" />
                                                    </p:column>
                                                    <p:column headerText="PrefLabel Origine" style="background-color: #ebedf0;">
                                                        <h:outputText value="#{resultat.prefLabelOrigine}" />
                                                    </p:column>
                                                    <p:column headerText="Id #{atelierThesBean.thesoSelected.value}">
                                                        <h:outputText value="#{resultat.idConcept}" />
                                                    </p:column>
                                                    <p:column headerText="PrefLabel #{atelierThesBean.thesoSelected.value}">
                                                        <h:outputText value="#{resultat.prefLabelConcept}" />
                                                    </p:column>
                                                    <p:column headerText="AltLabel">
                                                        <h:outputText value="#{resultat.altLabelConcept}" />
                                                    </p:column>
                                                    <p:column headerText="Terme Génerique">
                                                        <h:outputText value="#{resultat.termGenerique}" />
                                                    </p:column>
                                                    <p:column headerText="Définition">
                                                        <h:outputText value="#{resultat.definition}" />
                                                    </p:column>
                                                    <p:column headerText="URI Ark">
                                                        <h:outputText value="#{resultat.uriArk}" />
                                                    </p:column>
                                                </p:dataTable>
                                            </p:scrollPanel>

                                            <div class="row" style="margin-top: 15px;" >
                                                <div class="col-12" style="text-align: right">
                                                    <p:commandButton value="Export Résultat" icon="fas fa-download" ajax="false" rendered="#{atelierThesBean.result.size() > 0}"
                                                                     style="color: white; background: #43B572; border: #43B572;" update="containerIndex" >
                                                        <p:fileDownload value="#{atelierThesBean.exportResultat()}" />
                                                    </p:commandButton>
                                                </div>
                                            </div>
                                        </p:panel>
                                    </p:tab>

                                </p:wizard>

                                <p:commandButton id="cancelBtn" icon="fa fa-undo" class="btn btn-success"
                                                 style="font-size: 13px; color: white; background: #FFC107; border: #FFC107; margin-top: 10px"
                                                 actionListener="#{atelierThesBean.init()}" process="@this"
                                                 onclick="PF('wiz').loadStep(PF('wiz').cfg.steps[0], false);" update="containerIndex"/>
                            </div>
                        </div>
                    </div>
                    <ui:include src="../commun/footer.xhtml" />
                </h:form>
            </div>
        </h:panelGroup>
    </h:body>
</html>