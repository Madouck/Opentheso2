<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"  
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:p="http://primefaces.org/ui">

    <style type="text/css">
        .alignementVide {
            background-color: #F5F2F2 !important;
            color: #000 !important;
        }
    </style>

    <p:toolbar style="margin-top: 10px">
        <p:toolbarGroup align="center">
            <p:commandButton value="#{langueBean.getMsg('rightbody.conceptdialog.manage_alignment_sources')}" icon="fas fa-plus-circle" 
                             actionListener="#{setAlignmentSourceBean.init()}" process="@this" ajax="true"
                             oncomplete="PF('sourceManagement').show();"
                             update="sourceManagementID"/>

            <p:commandButton value="#{langueBean.getMsg('rightbody.conceptdialog.add_source')}" ajax="true"
                             action="#{setAlignmentSourceBean.initAddSource()}" icon="fas fa-sort-numeric-down"
                             oncomplete="PF('addSource').show();" style="margin-left: 10px"
                             process="@this" update="addSourceID"  />
        </p:toolbarGroup>
    </p:toolbar>


    <p:dataTable id="tableauAlignement" var="alignement" value="#{alignmentBean.allignementsList}"
                     rows="10" paginator="true" resizableColumns="true" showGridlines="true" size="small"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} alignement"
                     rowsPerPageTemplate="5,10,{ShowAll|'All'}" paginatorPosition="bottom"
                     rowStyleClass="#{alignement.targetUri == null ? 'alignementVide' : null}"  
                     scrollHeight="69%" styleClass=".ui-datatable-hor-scroll" style="font-size: 13px;">

            <p:columnGroup type="header">
                <p:row class="col-12">
                    <p:column filterBy="#{alignement.idConceptOrig}"   />
                    <p:column filterBy="#{alignement.labelConceptOrig}"  />                    
                    <p:column headerText="Concept cible" sortBy="#{alignement.typeAlignement}"  />
                    <p:column headerText="Type d'Alignement" sortBy="#{alignement.labelConceptCible}"  />
                    <p:column headerText="Target URI" sortBy="#{alignement.targetUri}" />
                    <p:column headerText="Actions" />
                </p:row>
                <p:row>
                    <p:column headerText="Identifiant" sortBy="#{alignement.idConceptOrig}" />
                    <p:column headerText="Etiquette" sortBy="#{alignement.labelConceptOrig}"  />
                </p:row>
            </p:columnGroup>

            <p:column>
                <h:outputText value="#{alignement.idConceptOrig}" />
            </p:column>

            <p:column >
                <h:outputText value="#{alignement.labelConceptOrig}" />
            </p:column>

            <p:column>
                <h:outputText value="#{alignement.labelConceptCible}" />
            </p:column>

            <p:column>
                <h:outputText value="#{alignement.typeAlignement}" />
            </p:column>

            <p:column>
                <h:outputLink value="#{alignement.targetUri}" target="_blank" >
                    <h:outputText rendered="#{alignement.targetUri != null}" value="#{alignement.targetUri}" />

                    <p:commandButton process="@this" rendered="#{alignement.targetUri == null}"
                                     update=":containerIndex:searchAlignementForm"
                                     actionListener="#{alignmentBean.openEditAlignementWindow(alignement)}"
                                     icon="pi pi-search" styleClass="rounded-button ui-button-raised"
                                     style="height: 30px; width: 30px" >
                        <p:resetInput target=":containerIndex:searchAlignementForm"/>
                    </p:commandButton>
                </h:outputLink>
            </p:column>

            <p:column>
                
                <p:commandButton process="@this" rendered="#{alignement.targetUri != null}" 
                                 action="#{alignmentManualBean.reset()}" icon="pi pi-pencil"
                                 actionListener="#{alignmentBean.setAlignementElementSelected(alignement)}"
                                 update=":containerIndex:idUpdateSingleAlignment"
                                 oncomplete="PF('updateSingleAlignment').show();"
                                 styleClass="edit-button rounded-button ui-button-success"
                                 style="height: 30px; width: 30px;" />

                <p:commandButton icon="pi pi-trash" process="@this" ajax="true"
                                 update=""
                                 oncomplete="PF('confirmDeleteAlignement').show()"
                                 actionListener="#{alignmentBean.setAlignementElementSelected(alignement)}"
                                 class="ui-button-danger rounded-button"
                                 rendered="#{alignement.targetUri != null}" 
                                 style="height: 30px; width: 30px; margin-left: 5px" />
            </p:column>
        </p:dataTable>


    <p:dialog id="idUpdateSingleAlignment" header="#{langueBean.getMsg('rightbody.concept.edit_alignment')}" widgetVar="updateSingleAlignment" 
              width="450" showEffect="fade" modal="true" resizable="false" position="top" style="margin-top: 30px" >

        <div class="row">
            <div class="col-12">
                <h:outputText value="#{langueBean.getMsg('rightbody.facetdialog.parent_concept')} : "
                              style="font-weight: bold"/>  
                <h:outputText value="#{conceptView.nodeConcept.term.lexical_value}"/>
            </div>
        </div>   

        <ui:repeat var="alignment" value="#{conceptView.nodeConcept.nodeAlignments}" >
            <div class="row">
                <div class="col-1" style="margin-top: 4px">
                    <p:commandLink style="color: #F7A269;" action="#{alignmentManualBean.updateAlignement(alignment)}"
                                   update="containerIndex:formRightTab">
                        <i class="pi pi-check-circle" />
                    </p:commandLink>
                </div>

                <div class="col-5">
                    <p:inputText value="#{alignment.uri_target}" style="color: #43B572; width: 100%"/> 
                </div>

                <div class="col-6">
                    <p:selectOneMenu id="relationType" value="#{alignment.alignement_id_type}" 
                                     style="width: 100%; background: white; border-color: #43B572">
                        <f:selectItems value="#{alignmentManualBean.nodeAlignmentTypes}" var="types"
                                       itemLabel="#{types.label} (#{types.labelSkos})" itemValue="#{types.id}"/>
                    </p:selectOneMenu>
                </div>
            </div>
        </ui:repeat>
    </p:dialog> 


    <p:dialog id="sourceManagementID" header="#{langueBean.getMsg('rightbody.conceptdialog.manage_alignment_sources')}" widgetVar="sourceManagement" 
              modal="true" resizable="true" position="top" width="500" style="margin-top: 50px" >

        <h5>
            <h:outputText value="#{selectedTheso.thesoName} (#{selectedTheso.currentIdTheso})" style="font-size: 14px;" />
        </h5>

        <p:panel style="max-height: 500px; margin-top: 10px; padding-left: 40px; overflow-y:scroll">
            <ui:repeat var="alignmentSource" value="#{setAlignmentSourceBean.nodeSelectedAlignmentsAll}">
                <div class="row" style="margin-top: 5px; font-size: 14px;">
                    <div class="col-1">
                        <p:selectBooleanCheckbox value="#{alignmentSource.isSelected}" />
                    </div>
                    <div class="col-11">
                        <h:outputLabel value="#{alignmentSource.sourceLabel}" style="color: #000" />
                    </div>
                </div>
            </ui:repeat>
        </p:panel>

        <div style="width: 100%; text-align: right; margin-top: 15px; margin-bottom: 5px;">
            <p:commandButton title="#{langueBean.getMsg('btnCancel')}" class="btn btn-secondary" style="margin-right: 10px"
                             actionListener="#{setAlignmentSourceBean.cancel()}" oncomplete="PF('sourceManagement').hide();" update="containerIndex"/>

            <p:commandButton class="btn btn-primary" title="#{langueBean.getMsg('btnValidate')}"
                             update="containerIndex messageIndex" oncomplete="PF('sourceManagement').hide();"
                             actionListener="#{setAlignmentSourceBean.updateSelectedAlignment()}"/>
        </div>
    </p:dialog>

    <p:dialog id="addSourceID" header="#{langueBean.getMsg('rightbody.conceptdialog.add_source')}" widgetVar="addSource" 
              modal="true" resizable="true" position="top" width="500" style="margin-top: 50px" >

        
        <div class="row" style="margin-bottom: 20px;">
            <div class="col-11 ">
                <h:outputText value="#{langueBean.getMsg('rightbody.conceptdialog.tooltip_add_source')}" style="font-size: 14px; font-weight: bold "/>
            </div> 
        </div>         
        
        <div class="row">
            <div class="col-4">
                <h:outputText value="#{langueBean.getMsg('statistique.label')}" style="font-size: 14px;"/>
            </div> 
            <div class="col-8">
                <p:inputText placeholder="#{langueBean.getMsg('rightbody.conceptdialog.source_name')}"
                             style="width: 100%; font-size: 14px;" value="#{setAlignmentSourceBean.sourceName}"/>
            </div>                                
        </div> 

        <div class="row" style="padding-top: 7px">
            <div class="col-4">
                <h:outputText value="#{langueBean.getMsg('rightbody.conceptdialog.uri')}" style="font-size: 14px;"/>
            </div> 
            <div class="col-8">
                <p:inputText placeholder="#{langueBean.getMsg('rightbody.conceptdialog.uri')}" style="width: 100%; font-size: 14px;" value="#{setAlignmentSourceBean.sourceUri}"/>
            </div>             
        </div>  

        <div class="row" style="padding-top: 7px">
            <div class="col-4">
                <h:outputText value="#{langueBean.getMsg('rightbody.conceptdialog.id_thesaurus')}" style="font-size: 14px;"/>
            </div> 
            <div class="col-8">
                <p:inputText placeholder="#{langueBean.getMsg('rightbody.conceptdialog.id_thesaurus')}" style="width: 100%; font-size: 14px;"
                             value="#{setAlignmentSourceBean.sourceIdTheso}" />
            </div>                   
        </div>      

        <div class="row" style="padding-top: 7px">
            <div class="col-4">
                <h:outputText value="Description" style="font-size: 14px;"/>
            </div> 
            <div class="col-8">
                <p:inputText placeholder="note" style="width: 100; font-size: 14px;" value="#{setAlignmentSourceBean.description}"/>
            </div> 
        </div>

        <div style="width: 100%; text-align: right; margin-top: 10px; margin-bottom: 5px;">

            <p:commandButton title="#{langueBean.getMsg('btnCancel')}" class="btn btn-secondary" style="margin-right: 10px"
                             actionListener="#{setAlignmentSourceBean.cancel()}" oncomplete="PF('addSource').hide();" 
                             update="addSourceID"/>

            <p:commandButton title="#{langueBean.getMsg('btnAdd')}" update="addSourceID messageIndex"
                             class="btn btn-primary" oncomplete="PF('addSource').hide();"
                             actionListener="#{setAlignmentSourceBean.addAlignmentSource(currentUser.nodeUser.idUser)}"/>
        </div> 
    </p:dialog>

</ui:fragment>